<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/public/styles.css">
    <title>C치maras de Seguridad</title>
</head>
<body>
    <header class="main-header">
        <h1>游뚱 Parqueo Inteligente</h1>
        <nav>
            <a href="/" class="nav-link">Dashboard</a>
            <a href="/parqueos" class="nav-link">Espacios</a>
            <a href="/camaras" class="nav-link active">C치maras</a>
        </nav>
    </header>

    <main>
        <section class="cameras-header">
            <h2>游닞 C치maras de Seguridad ESP32-CAM</h2>
            <p>Monitoreo en tiempo real del parqueo</p>
        </section>

        <section class="cameras-full-grid">
            <% if (cameraIds.length === 0) { %>
                <div class="no-cameras">
                    <h3>No hay c치maras activas</h3>
                    <p>Las c치maras aparecer치n aqu칤 cuando env칤en su primera imagen</p>
                </div>
            <% } else { %>
                <% cameraIds.forEach(camId => { 
                    const images = cameras[camId] || [];
                    const lastImage = images[images.length - 1];
                %>
                    <div class="camera-full">
                        <div class="camera-header">
                            <h3>C치mara <%= camId %></h3>
                            <span class="image-count"><%= images.length %> im치genes</span>
                        </div>
                        
                        <% if (lastImage) { %>
                            <div class="camera-current">
                                <img src="<%= lastImage.url %>" alt="C치mara <%= camId %>" 
                                     onclick="openImageModal('<%= lastImage.url %>', 'C치mara <%= camId %>')">
                                <div class="image-info">
                                    <div class="image-time">
                                        游늰 <%= new Date(lastImage.timestamp).toLocaleString() %>
                                    </div>
                                    <div class="image-size">
                                        游늺 <%= Math.round(lastImage.size / 1024) %> KB
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 칔ltimas 5 im치genes -->
                            <% if (images.length > 1) { %>
                                <div class="camera-history">
                                    <h4>Im치genes recientes</h4>
                                    <div class="history-thumbnails">
                                        <% images.slice(-6, -1).reverse().forEach(img => { %>
                                            <img src="<%= img.url %>" alt="Hist칩rico" class="thumbnail"
                                                 onclick="openImageModal('<%= img.url %>', 'C치mara <%= camId %>')">
                                        <% }) %>
                                    </div>
                                </div>
                            <% } %>
                        <% } else { %>
                            <div class="camera-no-image">
                                <div class="no-image-icon">游닝</div>
                                <p>Sin im치genes</p>
                                <small>Esta c치mara a칰n no ha enviado ninguna imagen</small>
                            </div>
                        <% } %>
                    </div>
                <% }) %>
            <% } %>
        </section>
    </main>

    <!-- Modal para ver im치genes en grande -->
    <div id="imageModal" class="modal" onclick="closeImageModal()">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <img id="modalImage" src="" alt="">
            <div id="modalTitle"></div>
        </div>
    </div>

    <script>
        function openImageModal(imageUrl, title) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalTitle = document.getElementById('modalTitle');
            
            modal.style.display = 'flex';
            modalImg.src = imageUrl;
            modalTitle.textContent = title;
        }

        function closeImageModal() {
            document.getElementById('imageModal').style.display = 'none';
        }

        // Cerrar modal con ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeImageModal();
            }
        });

        // Actualizar p치gina cada 30 segundos para nuevas im치genes
        setTimeout(() => {
            location.reload();
        }, 30000);
    </script>
</body>
</html>
